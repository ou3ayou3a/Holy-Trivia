<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Holy Trivia â€” Bible Multiplayer</title>
<script src="/socket.io/socket.io.js"></script>
<link href="https://fonts.googleapis.com/css2?family=Cinzel+Decorative:wght@400;700&family=Cinzel:wght@400;600;700&family=Crimson+Pro:ital,wght@0,400;0,600;1,400&display=swap" rel="stylesheet">
<style>
*{margin:0;padding:0;box-sizing:border-box}
body{background:#0a0608;font-family:'Crimson Pro',Georgia,serif;min-height:100vh;overflow-x:hidden;color:#e8dfc0}
body::before{content:'';position:fixed;inset:0;background:radial-gradient(ellipse 60% 40% at 20% 20%,rgba(180,60,20,.18) 0%,transparent 60%),radial-gradient(ellipse 50% 60% at 80% 10%,rgba(20,80,160,.18) 0%,transparent 60%),radial-gradient(ellipse 70% 50% at 50% 80%,rgba(160,20,120,.15) 0%,transparent 60%),radial-gradient(ellipse 40% 40% at 10% 70%,rgba(20,140,80,.12) 0%,transparent 60%),radial-gradient(ellipse 50% 30% at 90% 60%,rgba(200,160,20,.12) 0%,transparent 60%);pointer-events:none;z-index:0}
body::after{content:'';position:fixed;inset:0;background-image:repeating-linear-gradient(0deg,transparent,transparent 59px,rgba(255,255,255,.015) 60px),repeating-linear-gradient(90deg,transparent,transparent 59px,rgba(255,255,255,.015) 60px);pointer-events:none;z-index:0}
.page{position:relative;z-index:1;min-height:100vh;display:flex;flex-direction:column;align-items:center;justify-content:center;padding:20px}
.hidden{display:none!important}
.card{background:rgba(10,6,8,.88);backdrop-filter:blur(20px);border:1px solid rgba(255,255,255,.08);border-radius:3px;box-shadow:0 0 0 1px rgba(200,160,60,.1),0 24px 80px rgba(0,0,0,.7),inset 0 1px 0 rgba(255,255,255,.05);position:relative;overflow:hidden;width:100%;max-width:540px;padding:36px 32px}
.card::before{content:'';position:absolute;inset:0;background:linear-gradient(135deg,rgba(200,160,60,.04) 0%,transparent 50%);pointer-events:none}
h1{font-family:'Cinzel Decorative',serif;color:#e8c84a;text-align:center;font-size:clamp(1.8rem,5vw,3rem);line-height:1.1;text-shadow:0 0 40px rgba(232,200,74,.4),0 2px 4px rgba(0,0,0,.8)}
.subtitle{font-family:'Cinzel',serif;color:rgba(232,200,74,.5);font-size:.65rem;letter-spacing:.3em;text-transform:uppercase;text-align:center;margin-top:6px}
.divider{width:100%;height:1px;background:linear-gradient(90deg,transparent,rgba(232,200,74,.4),transparent);margin:20px 0}
.label{font-family:'Cinzel',serif;font-size:.6rem;letter-spacing:.2em;text-transform:uppercase;color:rgba(232,200,74,.5);margin-bottom:6px;display:block}
input[type=text]{background:rgba(255,255,255,.04);border:1px solid rgba(255,255,255,.1);border-radius:2px;color:#e8dfc0;font-family:'Crimson Pro',serif;font-size:1.1rem;padding:10px 16px;outline:none;width:100%;transition:border-color .2s;margin-bottom:16px}
input[type=text]:focus{border-color:rgba(232,200,74,.4)}
input::placeholder{color:rgba(255,255,255,.2)}
.btn{font-family:'Cinzel',serif;font-size:.72rem;letter-spacing:.15em;text-transform:uppercase;padding:12px 24px;border:none;cursor:pointer;border-radius:2px;transition:all .2s;width:100%;margin-bottom:8px}
.btn-gold{background:linear-gradient(135deg,#c9a830,#e8c84a,#c9a830);color:#1a1008;font-weight:700;box-shadow:0 4px 20px rgba(232,200,74,.3)}
.btn-gold:hover{box-shadow:0 6px 30px rgba(232,200,74,.5);transform:translateY(-1px)}
.btn-outline{background:transparent;border:1px solid rgba(232,200,74,.3);color:rgba(232,200,74,.7)}
.btn-outline:hover{border-color:rgba(232,200,74,.6);color:#e8c84a}
.btn-ghost{background:rgba(255,255,255,.04);border:1px solid rgba(255,255,255,.08);color:rgba(255,255,255,.5)}
.btn-ghost:hover{background:rgba(255,255,255,.07);color:rgba(255,255,255,.7)}
.btn-row{display:flex;gap:10px}.btn-row .btn{margin-bottom:0}
.btn-sm{font-size:.6rem;padding:8px 16px}
.btn:disabled{opacity:.4;cursor:not-allowed;transform:none!important}
.avatar-grid{display:grid;grid-template-columns:repeat(8,1fr);gap:6px;margin-bottom:16px}
.av{width:100%;aspect-ratio:1;background:rgba(255,255,255,.04);border:2px solid transparent;border-radius:50%;font-size:1.2rem;cursor:pointer;transition:all .15s;display:flex;align-items:center;justify-content:center}
.av:hover{background:rgba(255,255,255,.08);transform:scale(1.1)}
.av.sel{border-color:#e8c84a;background:rgba(232,200,74,.15)}
.diff-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:10px;margin-bottom:16px}
.diff-card{padding:14px 8px;border:1px solid rgba(255,255,255,.06);border-radius:2px;cursor:pointer;transition:all .2s;text-align:center;background:rgba(255,255,255,.02)}
.diff-card:hover{transform:translateY(-2px)}
.diff-card.sel-easy{border-color:rgba(80,200,120,.5);background:rgba(80,200,120,.07)}
.diff-card.sel-medium{border-color:rgba(232,200,74,.5);background:rgba(232,200,74,.07)}
.diff-card.sel-hard{border-color:rgba(220,60,60,.5);background:rgba(220,60,60,.07)}
.diff-icon{font-size:1.6rem;margin-bottom:6px}
.diff-name{font-family:'Cinzel',serif;font-size:.55rem;letter-spacing:.1em;color:rgba(255,255,255,.4);text-transform:uppercase;margin-bottom:3px}
.diff-label{font-family:'Crimson Pro',serif;font-size:.88rem;color:#e8dfc0;font-style:italic}
.mode-grid{display:grid;grid-template-columns:1fr 1fr;gap:8px;margin-bottom:16px}
.mode-card{padding:12px;border:1px solid rgba(255,255,255,.06);border-radius:2px;cursor:pointer;transition:all .2s;background:rgba(255,255,255,.02)}
.mode-card:hover{border-color:rgba(232,200,74,.2);background:rgba(255,255,255,.04)}
.mode-card.sel-mode{border-color:rgba(232,200,74,.4);background:rgba(232,200,74,.05)}
.mode-icon{font-size:1.2rem;margin-bottom:4px}
.mode-name{font-family:'Cinzel',serif;font-size:.6rem;letter-spacing:.08em;color:#e8c84a;text-transform:uppercase;margin-bottom:2px}
.mode-desc{font-size:.78rem;color:rgba(255,255,255,.35);line-height:1.3}
.room-code{font-family:'Cinzel Decorative',serif;font-size:2.8rem;color:#e8c84a;letter-spacing:.25em;text-align:center;text-shadow:0 0 30px rgba(232,200,74,.4)}
.badge{font-family:'Cinzel',serif;font-size:.55rem;letter-spacing:.1em;text-transform:uppercase;padding:3px 8px;border-radius:2px;margin:2px}
.badge-easy{background:rgba(80,200,120,.15);color:#80e8a0;border:1px solid rgba(80,200,120,.2)}
.badge-med{background:rgba(232,200,74,.15);color:#e8c050;border:1px solid rgba(232,200,74,.2)}
.badge-hard{background:rgba(220,60,60,.15);color:#e88080;border:1px solid rgba(220,60,60,.2)}
.tag{font-family:'Cinzel',serif;font-size:.55rem;letter-spacing:.1em;text-transform:uppercase;padding:3px 8px;border-radius:2px;margin:2px;background:rgba(255,255,255,.05);color:rgba(255,255,255,.3);border:1px solid rgba(255,255,255,.06)}
.badges-row{display:flex;flex-wrap:wrap;justify-content:center;gap:4px;margin:10px 0}
.player-list{display:flex;flex-direction:column;gap:6px;margin-bottom:16px}
.player-row{display:flex;align-items:center;gap:10px;padding:10px 14px;background:rgba(255,255,255,.03);border:1px solid rgba(255,255,255,.05);border-radius:2px;animation:slideIn .3s ease}
@keyframes slideIn{from{opacity:0;transform:translateX(-10px)}to{opacity:1;transform:translateX(0)}}
.p-av{font-size:1.3rem}.p-name{font-family:'Cinzel',serif;font-size:.78rem;letter-spacing:.05em;color:#e8dfc0;flex:1}
.p-host{font-family:'Cinzel',serif;font-size:.52rem;letter-spacing:.12em;text-transform:uppercase;color:#e8c84a;background:rgba(232,200,74,.1);padding:2px 7px;border-radius:2px}
.waiting{text-align:center;padding:14px;background:rgba(255,255,255,.02);border-radius:2px;border:1px solid rgba(255,255,255,.05);font-family:'Cinzel',serif;font-size:.6rem;letter-spacing:.15em;color:rgba(255,255,255,.25);text-transform:uppercase}
.countdown-wrap{text-align:center}
.countdown-num{font-family:'Cinzel Decorative',serif;font-size:min(20vw,160px);color:#e8c84a;text-shadow:0 0 80px rgba(232,200,74,.6);line-height:1;animation:cPop .85s ease-out}
@keyframes cPop{from{transform:scale(1.6);opacity:0}to{transform:scale(1);opacity:1}}
.countdown-sub{font-family:'Cinzel',serif;font-size:.7rem;letter-spacing:.3em;color:rgba(255,255,255,.25);text-transform:uppercase;margin-top:12px}
.game-card{max-width:640px}
.q-header{display:flex;align-items:center;justify-content:space-between;margin-bottom:12px}
.q-num{font-family:'Cinzel',serif;font-size:.62rem;letter-spacing:.2em;color:rgba(255,255,255,.3);text-transform:uppercase}
.q-timer{font-family:'Cinzel Decorative',serif;font-size:1.5rem;color:#e8c84a;text-shadow:0 0 20px rgba(232,200,74,.4);transition:color .3s}
.q-timer.urgent{color:#e85a4a;text-shadow:0 0 20px rgba(232,90,74,.6);animation:pulse .5s ease infinite}
@keyframes pulse{0%,100%{transform:scale(1)}50%{transform:scale(1.1)}}
.q-cat{font-family:'Cinzel',serif;font-size:.55rem;letter-spacing:.18em;text-transform:uppercase;color:rgba(232,200,74,.5);margin-bottom:8px}
.q-text{font-family:'Crimson Pro',serif;font-size:clamp(1.05rem,2.5vw,1.35rem);color:#e8dfc0;line-height:1.55;margin-bottom:18px}
.answers{display:grid;grid-template-columns:1fr 1fr;gap:9px}
@media(max-width:480px){.answers{grid-template-columns:1fr}}
.ans-btn{padding:12px 14px;background:rgba(255,255,255,.04);border:1px solid rgba(255,255,255,.08);border-radius:2px;color:#e8dfc0;font-family:'Crimson Pro',serif;font-size:.98rem;cursor:pointer;text-align:left;transition:all .2s;display:flex;align-items:flex-start;gap:9px;line-height:1.3;width:100%}
.ans-btn:hover:not(:disabled){background:rgba(232,200,74,.08);border-color:rgba(232,200,74,.3);transform:translateX(3px)}
.ans-btn:disabled{cursor:default}
.ans-btn.correct{background:rgba(80,200,120,.15);border-color:rgba(80,200,120,.5);color:#80e8a0}
.ans-btn.wrong{background:rgba(200,60,60,.08);border-color:rgba(200,60,60,.2);color:rgba(255,255,255,.3)}
.ans-btn.my-wrong{background:rgba(200,60,60,.2);border-color:rgba(200,60,60,.5);color:#e88080}
.ans-btn.my-correct{background:rgba(80,200,120,.2);border-color:rgba(80,200,120,.6);color:#80e880}
.ans-letter{font-family:'Cinzel',serif;font-size:.65rem;font-weight:700;color:rgba(232,200,74,.5);flex-shrink:0;margin-top:2px}
.verse-card{padding:14px 16px;background:rgba(232,200,74,.05);border:1px solid rgba(232,200,74,.15);border-radius:2px;margin-top:14px}
.verse-ref{font-family:'Cinzel',serif;font-size:.6rem;letter-spacing:.15em;color:#e8c84a;text-transform:uppercase;margin-bottom:6px}
.verse-result{font-family:'Crimson Pro',serif;font-style:italic;font-size:.95rem;color:rgba(255,255,255,.6);line-height:1.5}
.expl-text{font-size:.85rem;color:rgba(255,255,255,.4);margin-top:6px;line-height:1.5}
.mini-scores{display:flex;gap:7px;flex-wrap:wrap;justify-content:center;margin-bottom:10px}
.mini-score{display:flex;align-items:center;gap:5px;background:rgba(255,255,255,.04);padding:4px 9px;border-radius:2px;border:1px solid rgba(255,255,255,.06)}
.ms-name{font-family:'Cinzel',serif;font-size:.55rem;color:rgba(255,255,255,.35)}
.ms-pts{font-family:'Cinzel Decorative',serif;font-size:.85rem;color:#e8c84a}
.turn-bar{text-align:center;padding:9px;font-family:'Cinzel',serif;font-size:.7rem;letter-spacing:.1em;color:rgba(232,200,74,.6);text-transform:uppercase;background:rgba(232,200,74,.05);border-radius:2px;margin-bottom:12px;border:1px solid rgba(232,200,74,.1)}
.buzzer-wrap{display:flex;justify-content:center;margin-bottom:16px}
.buzzer{width:160px;height:160px;border-radius:50%;background:radial-gradient(circle at 35% 35%,#e85a2a,#8a2010);border:4px solid rgba(255,255,255,.15);color:white;font-family:'Cinzel Decorative',serif;font-size:1rem;cursor:pointer;transition:all .15s;box-shadow:0 8px 40px rgba(232,90,42,.5),inset 0 -6px 20px rgba(0,0,0,.4);line-height:1.3}
.buzzer:hover:not(:disabled){transform:scale(1.05);box-shadow:0 12px 50px rgba(232,90,42,.7)}
.buzzer:active:not(:disabled){transform:scale(.95)}
.buzzer:disabled{opacity:.4;cursor:not-allowed}
.buzzer.buzzed{background:radial-gradient(circle at 35% 35%,#50c870,#106830);box-shadow:0 8px 40px rgba(80,200,112,.5),inset 0 -6px 20px rgba(0,0,0,.4)}
.score-list{display:flex;flex-direction:column;gap:7px;margin-bottom:16px}
.score-row{display:flex;align-items:center;gap:12px;padding:12px 14px;border-radius:2px;border:1px solid transparent;position:relative;overflow:hidden}
.score-bar{position:absolute;left:0;top:0;bottom:0;background:rgba(232,200,74,.06);transition:width .7s ease;pointer-events:none}
.score-rank{font-family:'Cinzel Decorative',serif;font-size:1.05rem;width:30px;text-align:center;color:rgba(255,255,255,.25)}
.r1{color:#e8c84a!important}.r2{color:#a8a8a8!important}.r3{color:#c87840!important}
.score-av{font-size:1.4rem}.score-name{font-family:'Cinzel',serif;font-size:.75rem;letter-spacing:.05em;color:#e8dfc0;flex:1}
.score-delta{font-family:'Cinzel',serif;font-size:.62rem;animation:fadeUp .6s ease}
@keyframes fadeUp{from{opacity:0;transform:translateY(6px)}to{opacity:1;transform:translateY(0)}}
.score-pts{font-family:'Cinzel Decorative',serif;font-size:1.1rem;color:#e8c84a}
.me-row{border-color:rgba(232,200,74,.15)!important;background:rgba(232,200,74,.03)!important}
.players-answered{font-family:'Cinzel',serif;font-size:.6rem;color:rgba(255,255,255,.3);letter-spacing:.1em;text-transform:uppercase;text-align:center;margin-top:10px}
#toast{position:fixed;top:18px;left:50%;transform:translateX(-50%);background:rgba(10,6,8,.96);border:1px solid rgba(232,200,74,.3);padding:9px 20px;border-radius:2px;z-index:9999;font-family:'Cinzel',serif;font-size:.68rem;letter-spacing:.1em;color:#e8c84a;text-transform:uppercase;box-shadow:0 8px 30px rgba(0,0,0,.6);transition:opacity .3s;pointer-events:none}
.cf{position:fixed;inset:0;pointer-events:none;z-index:999;overflow:hidden}
.cf-p{position:absolute;top:-16px;width:9px;height:9px;border-radius:2px;animation:cfFall linear forwards}
@keyframes cfFall{from{transform:translateY(0) rotate(0deg);opacity:1}to{transform:translateY(110vh) rotate(720deg);opacity:0}}
.italic-quote{text-align:center;font-style:italic;font-size:.88rem;color:rgba(255,255,255,.25);line-height:1.5;margin-top:4px}
.conn-dot{width:8px;height:8px;border-radius:50%;background:#e85050;display:inline-block;margin-right:6px;transition:background .3s}
.conn-dot.on{background:#50e870}

/* â”€â”€ CHAT â”€â”€ */
#chat-wrap{position:fixed;bottom:20px;right:20px;width:300px;z-index:500;display:flex;flex-direction:column;gap:0}
#chat-wrap.hidden{display:none!important}
#chat-header{background:rgba(10,6,8,.95);border:1px solid rgba(232,200,74,.2);border-bottom:none;border-radius:3px 3px 0 0;padding:8px 14px;display:flex;align-items:center;justify-content:space-between;cursor:pointer}
#chat-title{font-family:'Cinzel',serif;font-size:.6rem;letter-spacing:.15em;text-transform:uppercase;color:rgba(232,200,74,.7)}
#chat-badge{background:#e85050;color:white;font-family:'Cinzel',serif;font-size:.55rem;padding:2px 6px;border-radius:10px;display:none}
#chat-body{background:rgba(10,6,8,.95);border:1px solid rgba(232,200,74,.2);border-top:none;border-radius:0 0 3px 3px;overflow:hidden;transition:height .2s ease}
#chat-body.collapsed{height:0!important;overflow:hidden}
#chat-msgs{height:200px;overflow-y:auto;padding:10px;display:flex;flex-direction:column;gap:6px;scrollbar-width:thin;scrollbar-color:rgba(255,255,255,.1) transparent}
#chat-msgs::-webkit-scrollbar{width:4px}
#chat-msgs::-webkit-scrollbar-thumb{background:rgba(255,255,255,.1);border-radius:2px}
.chat-msg{display:flex;gap:7px;align-items:flex-start;animation:slideIn .2s ease}
.chat-msg-av{font-size:1rem;flex-shrink:0;margin-top:1px}
.chat-msg-body{flex:1;min-width:0}
.chat-msg-name{font-family:'Cinzel',serif;font-size:.55rem;color:rgba(232,200,74,.6);margin-bottom:2px}
.chat-msg-text{font-family:'Crimson Pro',serif;font-size:.88rem;color:#e8dfc0;line-height:1.4;word-break:break-word}
.chat-msg.system .chat-msg-text{color:rgba(255,255,255,.3);font-style:italic;font-size:.8rem}
#chat-input-row{display:flex;gap:0;border-top:1px solid rgba(255,255,255,.06)}
#chat-input{background:rgba(255,255,255,.04);border:none;color:#e8dfc0;font-family:'Crimson Pro',serif;font-size:.9rem;padding:9px 12px;flex:1;outline:none}
#chat-input::placeholder{color:rgba(255,255,255,.2)}
#chat-send{background:rgba(232,200,74,.15);border:none;color:#e8c84a;font-family:'Cinzel',serif;font-size:.6rem;padding:9px 12px;cursor:pointer;transition:background .2s;letter-spacing:.05em}
#chat-send:hover{background:rgba(232,200,74,.25)}

/* â”€â”€ MUSIC â”€â”€ */
#music-btn{position:fixed;bottom:20px;left:20px;z-index:500;background:rgba(10,6,8,.9);border:1px solid rgba(232,200,74,.2);border-radius:50%;width:44px;height:44px;display:flex;align-items:center;justify-content:center;cursor:pointer;font-size:1.1rem;transition:all .2s;color:#e8c84a}
#music-btn:hover{border-color:rgba(232,200,74,.5);background:rgba(232,200,74,.08)}
#music-btn.playing{border-color:rgba(232,200,74,.5);animation:musicPulse 2s ease infinite}
@keyframes musicPulse{0%,100%{box-shadow:0 0 0 0 rgba(232,200,74,.3)}50%{box-shadow:0 0 0 8px rgba(232,200,74,0)}}
</style>
</head>
<body>

<!-- HOME -->
<div id="screen-home" class="page">
  <div class="card">
    <h1>Holy Trivia</h1>
    <div class="subtitle">âœ¦ Multiplayer Bible Challenge âœ¦</div>
    <div class="divider"></div>
    <label class="label">Your Name</label>
    <input type="text" id="home-name" placeholder="Enter your name..." maxlength="20">
    <label class="label">Choose Your Avatar</label>
    <div class="avatar-grid" id="avatar-grid"></div>
    <button class="btn btn-gold" onclick="goSetup()">âœ› Create a Room</button>
    <button class="btn btn-outline" onclick="goJoin()">â†’ Join a Room</button>
    <div class="italic-quote">"Thy word is a lamp unto my feet" â€” Psalm 119:105</div>
    <div style="text-align:center;margin-top:10px;font-family:Cinzel,serif;font-size:.55rem;letter-spacing:.1em;color:rgba(255,255,255,.2)">
      <span class="conn-dot" id="conn-dot"></span><span id="conn-label">Connecting...</span>
    </div>
  </div>
</div>

<!-- JOIN -->
<div id="screen-join" class="page hidden">
  <div class="card" style="max-width:400px">
    <h1 style="font-size:1.8rem">Join Room</h1>
    <div class="subtitle">âœ¦ Enter the room code âœ¦</div>
    <div class="divider"></div>
    <label class="label">Room Code</label>
    <input type="text" id="join-code" placeholder="e.g. AB3F7Z" maxlength="6" style="text-align:center;font-size:1.8rem;letter-spacing:.3em;font-family:'Cinzel',serif;text-transform:uppercase">
    <div class="btn-row">
      <button class="btn btn-ghost" onclick="show('home')">â† Back</button>
      <button class="btn btn-gold" onclick="doJoin()">Join â†’</button>
    </div>
  </div>
</div>

<!-- SETUP -->
<div id="screen-setup" class="page hidden">
  <div class="card" style="max-width:580px">
    <h1 style="font-size:1.7rem">Room Settings</h1>
    <div class="subtitle">âœ¦ Configure your game âœ¦</div>
    <div class="divider"></div>
    <label class="label">Difficulty</label>
    <div class="diff-grid">
      <div class="diff-card" id="diff-easy" onclick="selDiff('easy')"><div class="diff-icon">ğŸ™‚</div><div class="diff-name">Easy</div><div class="diff-label">Lukewarm Christian</div></div>
      <div class="diff-card" id="diff-medium" onclick="selDiff('medium')"><div class="diff-icon">ğŸ“–</div><div class="diff-name">Medium</div><div class="diff-label">Occasional Reader</div></div>
      <div class="diff-card" id="diff-hard" onclick="selDiff('hard')"><div class="diff-icon">ğŸ”¥</div><div class="diff-name">Hard</div><div class="diff-label">Hardcore Fanatic</div></div>
    </div>
    <label class="label">Game Mode</label>
    <div class="mode-grid">
      <div class="mode-card" id="mode-buzzer" onclick="selMode('buzzer')"><div class="mode-icon">ğŸ””</div><div class="mode-name">Fast Buzzer</div><div class="mode-desc">First to buzz in. Wrong = -2 pts!</div></div>
      <div class="mode-card" id="mode-simultaneous" onclick="selMode('simultaneous')"><div class="mode-icon">âš¡</div><div class="mode-name">Speed Round</div><div class="mode-desc">All answer at once. Fastest correct wins bonus!</div></div>
      <div class="mode-card" id="mode-turnbased" onclick="selMode('turnbased')"><div class="mode-icon">ğŸ¯</div><div class="mode-name">Turn-Based</div><div class="mode-desc">Each player answers on their turn.</div></div>
      <div class="mode-card" id="mode-kahoot" onclick="selMode('kahoot')"><div class="mode-icon">ğŸ†</div><div class="mode-name">Holy Kahoot</div><div class="mode-desc">Correct + fast = max points!</div></div>
    </div>
    <div class="btn-row">
      <button class="btn btn-ghost" onclick="show('home')">â† Back</button>
      <button class="btn btn-gold" onclick="createRoom()">Create Room â†’</button>
    </div>
  </div>
</div>

<!-- LOBBY -->
<div id="screen-lobby" class="page hidden">
  <div class="card">
    <label class="label" style="text-align:center">Room Code</label>
    <div class="room-code" id="lobby-code">------</div>
    <div style="text-align:center;font-style:italic;font-size:.85rem;color:rgba(255,255,255,.3);margin-top:6px">Share this code with friends</div>
    <div class="badges-row" id="lobby-badges"></div>
    <div class="divider"></div>
    <label class="label" id="lobby-pcount">Players (1)</label>
    <div class="player-list" id="lobby-players"></div>
    <div id="lobby-host-btn"><button class="btn btn-gold" onclick="startGame()">âœ› Begin the Challenge</button></div>
    <div id="lobby-wait" class="waiting hidden">Waiting for host to start...</div>
    <button class="btn btn-ghost btn-sm" onclick="goHome()" style="margin-top:4px">Leave Room</button>
  </div>
</div>

<!-- COUNTDOWN -->
<div id="screen-countdown" class="page hidden">
  <div class="countdown-wrap">
    <div class="countdown-num" id="countdown-num">3</div>
    <div class="countdown-sub">Get ready...</div>
  </div>
</div>

<!-- GAME -->
<div id="screen-game" class="page hidden">
  <div class="card game-card">
    <div class="q-header">
      <div class="q-num" id="q-num">Question 1 / 10</div>
      <div class="q-timer" id="q-timer">20s</div>
    </div>
    <div class="mini-scores" id="mini-scores"></div>
    <div class="turn-bar hidden" id="turn-bar">Your Turn!</div>
    <div class="q-cat" id="q-cat"></div>
    <div class="q-text" id="q-text"></div>
    <div class="buzzer-wrap hidden" id="buzzer-wrap">
      <button class="buzzer" id="buzzer-btn" onclick="pressBuzzer()">BUZZ<br>IN!</button>
    </div>
    <div class="answers" id="answers"></div>
    <div class="verse-card hidden" id="verse-card">
      <div class="verse-ref" id="verse-ref"></div>
      <div class="verse-result" id="verse-result"></div>
      <div class="expl-text" id="verse-expl"></div>
    </div>
    <div class="players-answered hidden" id="players-answered"></div>
    <button class="btn btn-gold hidden" id="next-btn" onclick="sendNextQuestion()" style="margin-top:12px">Next Question â†’</button>
    <div class="waiting hidden" id="wait-host" style="margin-top:12px">Waiting for host...</div>
  </div>
</div>

<!-- SCOREBOARD -->
<div id="screen-scoreboard" class="page hidden">
  <div class="card" style="max-width:480px">
    <div style="text-align:center;margin-bottom:4px;font-size:1.2rem">âŠ•</div>
    <div style="text-align:center;font-family:'Cinzel',serif;font-size:.65rem;letter-spacing:.2em;color:rgba(255,255,255,.3);text-transform:uppercase;margin-bottom:2px" id="sb-title">Scoreboard</div>
    <div class="divider"></div>
    <div class="score-list" id="sb-list"></div>
    <div style="text-align:center;font-family:'Cinzel',serif;font-size:.6rem;color:rgba(255,255,255,.2);letter-spacing:.15em;text-transform:uppercase">Next question in <span id="sb-countdown">3</span>s...</div>
  </div>
</div>

<!-- FINAL -->
<div id="screen-final" class="page hidden">
  <div id="cf-wrap"></div>
  <div class="card" style="max-width:520px">
    <div id="final-top" style="text-align:center">
      <div style="font-size:2.8rem;margin-bottom:8px">ğŸ†</div>
      <h1 style="font-size:2rem">Final Results</h1>
      <div class="subtitle">âœ¦ The Lord has spoken âœ¦</div>
    </div>
    <div class="divider"></div>
    <div class="score-list" id="final-list"></div>
    <div id="final-message" style="display:none;margin:14px 0;padding:14px 16px;background:rgba(232,200,74,.07);border:1px solid rgba(232,200,74,.2);border-radius:2px;font-family:'Crimson Pro',serif;font-size:1.05rem;color:#e8dfc0;line-height:1.5;text-align:center;font-style:italic"></div>
    <div class="divider"></div>
    <div class="italic-quote" id="final-quote">"Well done, good and faithful servant" â€” Matthew 25:23</div>
    <div style="height:12px"></div>
    <div class="btn-row">
      <button class="btn btn-ghost" onclick="goHome()">â† Home</button>
      <button class="btn btn-gold" id="play-again-btn" style="display:none" onclick="goSetup()">Play Again âœ›</button>
    </div>
  </div>
</div>

<div id="toast" style="opacity:0"></div>

<script>
// â”€â”€ CONFIG â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const socket = io();

// â”€â”€ STATE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const S = {
  name:'', avatar:'âœï¸', roomCode:'', isHost:false,
  diff:'easy', mode:'simultaneous',
  questions:[], qIndex:0, currentQ:null,
  myAnswer:null, showResult:false,
  timeLeft:20, timerInterval:null,
  scores:{}, players:[],
  buzzedId:null, hasBuzzed:false,
  qStartTime:0, deltaScores:{},
  answeredCount:0,
};

const AVATARS=['âœï¸','ğŸ™','ğŸ“–','â›ª','ğŸ•Šï¸','â­','ğŸ‘¼','ğŸŒŸ','ğŸ”¥','ğŸŒ¿','ğŸº','ğŸº','ğŸ—ï¸','ğŸ•¯ï¸','ğŸ¦','ğŸŒŠ'];
const DIFF_LABELS={easy:'Lukewarm Christian',medium:'Occasional Reader',hard:'Hardcore Fanatic'};
const MODE_NAMES={buzzer:'Fast Buzzer',simultaneous:'Speed Round',turnbased:'Turn-Based',kahoot:'Holy Kahoot'};
const WRONG_TAUNTS={
  easy:["Even your grandma knew that one. ğŸ˜¬","That was EASY mode. Lord help us. ğŸ’€","Did you even go to Sunday School? ğŸ˜…","Moses is personally disappointed. ğŸ˜”","Jesus wept. Literally, because of THIS. ğŸ˜­","My guy really said that. In church. ğŸ¤¦","Bro that was in Genesis chapter ONE. ğŸ“–"],
  medium:["Back to Bible study. Immediately. ğŸ“–","Even Judas knew this one. JUDAS. ğŸª™","Paul wrote 13 epistles. Try reading one. ğŸ“œ","The disciples would like a word. ğŸ˜¤"],
  hard:["Okay this one was hard. Still -1 tho. ğŸ˜…","Seminary is calling. Answer the phone. ğŸ“","The Dead Sea Scrolls are judging you. ğŸ“œ","Even the Pharisees knew that. EVEN THEM. ğŸ“¿"]
};
const TIMEOUT_TAUNTS=["â° Praying for more time? Didn't work. Answer: ","â° Creation took 6 days. You had 20 seconds. Answer: ","â° The Spirit was willing, the fingers were slow. Answer: "];
const WINNER_ROASTS={
  easy:["ğŸ‰ You won the EASY round. Don't get too excited, Lukewarm.","ğŸ‘‘ First place on Easy! Your Sunday School teacher from 1998 is mildly impressed.","âœï¸ You won! Don't be happy â€” you're still just a Lukewarm Christian.","ğŸŠ Winner! You now officially know more than someone who's never opened a Bible. The bar was low."],
  medium:["ğŸ”¥ Winner! You're no longer lukewarm â€” you're maybe slightly warm. Progress!","ğŸ“– First place! The Occasional Reader has risen. Elijah would be... mildly nodding.","âœï¸ You won the Medium round. Peter denied Jesus 3 times. You answered right more than that.","ğŸ‘‘ First place! 'Probably Opened a Bible This Decade.'"],
  hard:["ğŸ”¥ THE HARDCORE JESUS FANATIC CLAIMS VICTORY. Angels are writing this down.","ğŸ“¿ First on HARD mode. Your concordance is showing. We respect the dedication.","âœï¸ You absolute Bible nerd. Most impressive thing since memorizing Leviticus.","ğŸ‘‘ Paul himself would write you a letter. Probably Philippians again."]
};
const LOSER_SHAME={
  easy:["What are you??? JEWISH??? Hell is warm this time of season. ğŸ”¥"],
  medium:["What are you??? JEWISH??? Hell is warm this time of season. ğŸ”¥"],
  hard:["What are you??? JEWISH??? Hell is warm this time of season. ğŸ”¥"]
};
let toastTimeout=null;

// â”€â”€ INIT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function init(){
  buildAvatarGrid();
  selDiff('easy');
  selMode('simultaneous');
}
function buildAvatarGrid(){
  document.getElementById('avatar-grid').innerHTML=AVATARS.map((a,i)=>
    `<button class="av${i===0?' sel':''}" onclick="pickAvatar(this,'${a}')">${a}</button>`
  ).join('');
}
function pickAvatar(el,av){
  document.querySelectorAll('.av').forEach(b=>b.classList.remove('sel'));
  el.classList.add('sel'); S.avatar=av;
}
function selDiff(d){S.diff=d;['easy','medium','hard'].forEach(x=>{const el=document.getElementById('diff-'+x);el.className='diff-card';if(x===d)el.classList.add('sel-'+x);});}
function selMode(m){S.mode=m;['buzzer','simultaneous','turnbased','kahoot'].forEach(x=>{const el=document.getElementById('mode-'+x);el.className='mode-card';if(x===m)el.classList.add('sel-mode');});}
function show(name){
  document.querySelectorAll('.page').forEach(p=>p.classList.add('hidden'));
  document.getElementById('screen-'+name).classList.remove('hidden');
  if(['lobby','game','scoreboard','final'].includes(name)) showChat();
  else hideChat();
}
function goSetup(){const nm=document.getElementById('home-name').value.trim();if(!nm){toast('Enter your name first!');return;}S.name=nm;show('setup');}
function goJoin(){const nm=document.getElementById('home-name').value.trim();if(!nm){toast('Enter your name first!');return;}S.name=nm;show('join');}
function goHome(){if(S.timerInterval)clearInterval(S.timerInterval);S.roomCode='';S.isHost=false;show('home');}

// â”€â”€ SOCKET EVENTS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
socket.on('connect',()=>{
  document.getElementById('conn-dot').classList.add('on');
  document.getElementById('conn-label').textContent='Connected';
});
socket.on('disconnect',()=>{
  document.getElementById('conn-dot').classList.remove('on');
  document.getElementById('conn-label').textContent='Disconnected';
  toast('Connection lost! Reconnecting...');
});
socket.on('error',(msg)=>toast(msg));

socket.on('room_created',({code,room})=>{
  S.roomCode=code; S.isHost=true;
  S.players=room.players; S.scores=room.scores;
  renderLobby(code,room);
  show('lobby');
});

socket.on('room_joined',({code,room})=>{
  S.roomCode=code; S.isHost=false;
  S.players=room.players; S.scores=room.scores;
  renderLobby(code,room);
  show('lobby');
  toast('Joined room '+code+'!');
});

socket.on('lobby_update',(room)=>{
  S.players=room.players; S.scores=room.scores;
  renderLobby(S.roomCode,room);
});

socket.on('player_left',({players,scores})=>{
  S.players=players; S.scores=scores;
  toast('A player left the room');
  renderLobbyPlayers(players);
  if(chatVisible) appendChatMsg({ text: 'A player left the room.', system: true });
});

socket.on('game_starting',({questions,diff,mode})=>{
  S.questions=questions; S.diff=diff; S.mode=mode;
  S.qIndex=0; S.myAnswer=null; S.showResult=false; S.deltaScores={};
});

socket.on('countdown_tick',(n)=>{
  show('countdown');
  const el=document.getElementById('countdown-num');
  el.textContent=n>0?n:'GO!';
  el.style.animation='none';
  requestAnimationFrame(()=>requestAnimationFrame(()=>{ el.style.animation=''; }));
});

socket.on('question_start',({qIndex,question,scores,players})=>{
  S.qIndex=qIndex; S.currentQ=question;
  S.scores=scores; S.players=players;
  S.myAnswer=null; S.showResult=false;
  S.buzzedId=null; S.hasBuzzed=false;
  S.deltaScores={}; S.answeredCount=0;
  renderQuestion();
  startTimer();
  show('game');
});

socket.on('buzzed',({playerId,playerName})=>{
  S.buzzedId=playerId;
  const bb=document.getElementById('buzzer-btn');
  bb.disabled=true;
  if(playerId===socket.id){
    bb.className='buzzer buzzed'; bb.innerHTML='âœ“ Buzzed!';
  } else {
    bb.innerHTML=playerName+' buzzed!';
  }
  if(playerId===socket.id) renderAnswers(false);
  toast(playerName+' buzzed in!');
});

socket.on('player_answered',({playerId,correct,pts,scores})=>{
  S.scores=scores;
  S.answeredCount++;
  if(playerId!==socket.id){
    S.deltaScores[playerId]=pts;
  }
  renderMiniScores();
  const pa=document.getElementById('players-answered');
  pa.classList.remove('hidden');
  pa.textContent=S.answeredCount+' / '+S.players.length+' answered';
});

socket.on('reveal_answer',({correctIndex,reference,explanation,scores,answeredIds,players})=>{
  S.scores=scores; S.players=players;
  if(S.timerInterval) clearInterval(S.timerInterval);
  S.showResult=true;
  showResultUI(correctIndex,reference,explanation,answeredIds);
});

socket.on('game_over',({scores,players})=>{
  S.scores=scores; S.players=players;
  if(S.timerInterval) clearInterval(S.timerInterval);
  showFinal();
});

// â”€â”€ CREATE / JOIN â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function createRoom(){
  socket.emit('create_room',{name:S.name,avatar:S.avatar,diff:S.diff,mode:S.mode});
}
function doJoin(){
  const code=document.getElementById('join-code').value.toUpperCase().trim();
  if(!code){toast('Enter a room code!');return;}
  socket.emit('join_room',{code,name:S.name,avatar:S.avatar});
}
function startGame(){
  if(!S.isHost) return;
  socket.emit('start_game');
}
function sendNextQuestion(){
  if(!S.isHost) return;
  showScoreboard();
}
function pressBuzzer(){
  if(S.hasBuzzed||S.buzzedId) return;
  S.hasBuzzed=true;
  socket.emit('buzz_in');
}

// â”€â”€ RENDER LOBBY â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function renderLobby(code,room){
  document.getElementById('lobby-code').textContent=code;
  const badgeCls={easy:'badge-easy',medium:'badge-med',hard:'badge-hard'}[room.diff||S.diff];
  document.getElementById('lobby-badges').innerHTML=
    `<span class="badge ${badgeCls}">${DIFF_LABELS[room.diff||S.diff]}</span>`+
    `<span class="tag">${MODE_NAMES[room.mode||S.mode]}</span>`+
    `<span class="tag">10 Questions</span>`;
  renderLobbyPlayers(room.players||[]);
  if(S.isHost){
    document.getElementById('lobby-host-btn').style.display='block';
    document.getElementById('lobby-wait').classList.add('hidden');
  } else {
    document.getElementById('lobby-host-btn').style.display='none';
    document.getElementById('lobby-wait').classList.remove('hidden');
  }
}
function renderLobbyPlayers(players){
  document.getElementById('lobby-pcount').textContent='Players ('+players.length+')';
  document.getElementById('lobby-players').innerHTML=players.map(p=>
    `<div class="player-row"><span class="p-av">${p.avatar}</span><span class="p-name">${p.name}</span>${p.isHost?'<span class="p-host">Host</span>':''}</div>`
  ).join('');
}

// â”€â”€ RENDER QUESTION â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function renderQuestion(){
  const q=S.currentQ;
  if(!q) return;
  document.getElementById('q-num').textContent='Question '+(S.qIndex+1)+' / '+S.questions.length;
  document.getElementById('q-cat').textContent=q.cat;
  document.getElementById('q-text').textContent=q.q;
  document.getElementById('verse-card').classList.add('hidden');
  document.getElementById('next-btn').classList.add('hidden');
  document.getElementById('wait-host').classList.add('hidden');
  document.getElementById('players-answered').classList.add('hidden');
  document.getElementById('players-answered').textContent='';
  const tb=document.getElementById('turn-bar');
  if(S.mode==='turnbased'){
    tb.classList.remove('hidden');
    const turnPlayer=S.players[S.qIndex%S.players.length];
    if(turnPlayer&&turnPlayer.id===socket.id) tb.textContent='âš¡ Your Turn!';
    else tb.textContent=(turnPlayer?turnPlayer.avatar+' '+turnPlayer.name:'Someone')+"'s Turn";
  } else { tb.classList.add('hidden'); }
  const bw=document.getElementById('buzzer-wrap');
  const bb=document.getElementById('buzzer-btn');
  if(S.mode==='buzzer'){
    bw.classList.remove('hidden');
    bb.disabled=false; bb.className='buzzer'; bb.innerHTML='BUZZ<br>IN!';
  } else { bw.classList.add('hidden'); }
  renderAnswers(false);
  renderMiniScores();
  S.qStartTime=Date.now();
}

function renderAnswers(revealed){
  const q=S.currentQ; if(!q) return;
  const isTurnBased=S.mode==='turnbased';
  const turnPlayer=S.players[S.qIndex%S.players.length];
  const isMyTurn=!isTurnBased||(turnPlayer&&turnPlayer.id===socket.id);
  const isBuzzer=S.mode==='buzzer';
  const canAnswer=S.myAnswer===null&&isMyTurn&&(!isBuzzer||S.buzzedId===socket.id);
  if(isBuzzer&&!S.buzzedId&&!revealed){ document.getElementById('answers').innerHTML=''; return; }
  document.getElementById('answers').innerHTML=q.a.map((ans,i)=>{
    let cls='ans-btn';
    if(revealed||S.showResult){
      if(i===q.c) cls+=' correct';
      else if(i===S.myAnswer) cls+=' my-wrong';
      else cls+=' wrong';
    } else if(S.myAnswer===i) cls+=' my-correct';
    const disabled=(!canAnswer||S.myAnswer!==null)?'disabled':'';
    return `<button class="${cls}" ${disabled} onclick="submitAnswer(${i})"><span class="ans-letter">${['A','B','C','D'][i]}</span><span>${ans}</span></button>`;
  }).join('');
}

function renderMiniScores(){
  document.getElementById('mini-scores').innerHTML=S.players.map(p=>{
    const pts=S.scores[p.id]||0;
    return `<div class="mini-score"${p.id===socket.id?' style="border-color:rgba(232,200,74,.2)"':''}>
      <span>${p.avatar}</span><span class="ms-name">${p.name.split(' ')[0]}</span>
      <span class="ms-pts" style="color:${pts<0?'#e85050':'#e8c84a'}">${pts}</span>
    </div>`;
  }).join('');
}

// â”€â”€ TIMER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function startTimer(){
  if(S.timerInterval) clearInterval(S.timerInterval);
  S.timeLeft=20;
  updateTimerUI();
  S.timerInterval=setInterval(()=>{
    S.timeLeft--;
    updateTimerUI();
    if(S.timeLeft<=0){
      clearInterval(S.timerInterval);
      if(S.myAnswer===null){ S.myAnswer=-1; }
      if(S.isHost) socket.emit('time_up');
    }
  },1000);
}
function updateTimerUI(){
  const el=document.getElementById('q-timer');
  el.textContent=S.timeLeft+'s';
  el.className='q-timer'+(S.timeLeft<=5?' urgent':'');
}

// â”€â”€ SUBMIT ANSWER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function submitAnswer(idx){
  if(S.myAnswer!==null) return;
  if(S.timerInterval) clearInterval(S.timerInterval);
  S.myAnswer=idx;
  renderAnswers(false);
  const timeTaken=(Date.now()-S.qStartTime)/1000;
  socket.emit('submit_answer',{answerIdx:idx,timeTaken});
}

// â”€â”€ RESULT UI â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function showResultUI(correctIdx,reference,explanation,answeredIds){
  renderAnswers(true);
  const q=S.currentQ;
  const vc=document.getElementById('verse-card');
  vc.classList.remove('hidden');
  document.getElementById('verse-ref').textContent='ğŸ“– '+reference;
  const taunts=(WRONG_TAUNTS[S.diff]||WRONG_TAUNTS.easy);
  const taunt=taunts[Math.floor(Math.random()*taunts.length)];
  const timeout=TIMEOUT_TAUNTS[Math.floor(Math.random()*TIMEOUT_TAUNTS.length)];
  let resultText='';
  if(S.myAnswer===correctIdx) resultText='âœ… Correct! The answer is: ';
  else if(S.myAnswer===-1||S.myAnswer===null) resultText=timeout;
  else resultText='âŒ Wrong! '+taunt+'<br><span style="font-size:.8rem;opacity:.7">Correct answer:</span> ';
  document.getElementById('verse-result').innerHTML=resultText+'<strong style="color:#80e880">'+q.a[correctIdx]+'</strong>';
  document.getElementById('verse-expl').textContent=explanation||'';
  document.getElementById('players-answered').classList.add('hidden');
  if(S.isHost){
    document.getElementById('next-btn').classList.remove('hidden');
    document.getElementById('next-btn').textContent=S.qIndex+1>=S.questions.length?'ğŸ† See Final Results':'Next Question â†’';
  } else {
    document.getElementById('wait-host').classList.remove('hidden');
  }
}

// â”€â”€ SCOREBOARD â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function showScoreboard(){
  const sorted=[...S.players].sort((a,b)=>(S.scores[b.id]||0)-(S.scores[a.id]||0));
  const maxPts=Math.max(...sorted.map(p=>S.scores[p.id]||0),1);
  const icons=['ğŸ‘‘','ğŸ¥ˆ','ğŸ¥‰'];
  document.getElementById('sb-title').textContent='After Question '+(S.qIndex+1);
  document.getElementById('sb-list').innerHTML=sorted.map((p,i)=>{
    const pts=S.scores[p.id]||0;
    const d=S.deltaScores[p.id];
    const rankCls=i<3?'r'+(i+1):'';
    const meRow=p.id===socket.id?'me-row':'';
    return `<div class="score-row ${meRow}" style="border:1px solid rgba(255,255,255,.04)">
      <div class="score-bar" style="width:${Math.round((pts/maxPts)*100)}%"></div>
      <div class="score-rank ${rankCls}">${i<3?icons[i]:i+1}</div>
      <div class="score-av">${p.avatar}</div>
      <div class="score-name">${p.name}</div>
      ${d?`<div class="score-delta" style="color:${d<0?'#e85050':'#80e880'}">${d>0?'+':''}${d}</div>`:''}
      <div class="score-pts" style="color:${pts<0?'#e85050':'#e8c84a'}">${pts}</div>
    </div>`;
  }).join('');
  show('scoreboard');
  let c=3;
  document.getElementById('sb-countdown').textContent=c;
  const iv=setInterval(()=>{
    c--;
    document.getElementById('sb-countdown').textContent=c;
    if(c<=0){ clearInterval(iv); socket.emit('next_question'); }
  },1000);
}

// â”€â”€ FINAL â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function showFinal(){
  const sorted=[...S.players].sort((a,b)=>(S.scores[b.id]||0)-(S.scores[a.id]||0));
  const myPts=S.scores[socket.id]||0;
  const isMulti=S.players.length>1;
  const amWinner=sorted[0]&&sorted[0].id===socket.id&&myPts>0;
  const amLoser=myPts<=0;
  const showWinner=isMulti?amWinner:(myPts>=5);
  const showLoser=isMulti?amLoser:(myPts<5);
  const ft=document.getElementById('final-top');
  if(showLoser){
    ft.innerHTML='<div style="font-size:2.8rem;margin-bottom:8px">ğŸ”¥</div><h1 style="font-family:Cinzel Decorative,serif;color:#e85050;text-align:center;font-size:clamp(1.6rem,4vw,2.5rem);text-shadow:0 0 40px rgba(232,80,50,.6)">Game Over</h1><div style="font-family:Cinzel,serif;color:rgba(232,80,50,.5);font-size:.65rem;letter-spacing:.3em;text-transform:uppercase;text-align:center;margin-top:6px">âœ¦ THE LORD HAS SEEN EVERYTHING âœ¦</div>';
  } else {
    ft.innerHTML='<div style="font-size:2.8rem;margin-bottom:8px">ğŸ†</div><h1 style="font-family:Cinzel Decorative,serif;color:#e8c84a;text-align:center;font-size:clamp(1.6rem,4vw,2.5rem)">Final Results</h1><div style="font-family:Cinzel,serif;color:rgba(232,200,74,.5);font-size:.65rem;letter-spacing:.3em;text-transform:uppercase;text-align:center;margin-top:6px">âœ¦ THE LORD HAS SPOKEN âœ¦</div>';
  }
  const maxPts=Math.max(...sorted.map(p=>S.scores[p.id]||0),1);
  const icons=['ğŸ‘‘','ğŸ¥ˆ','ğŸ¥‰'];
  document.getElementById('final-list').innerHTML=sorted.map((p,i)=>{
    const pts=S.scores[p.id]||0;
    const isFirst=i===0&&pts>0; const isBad=pts<=0;
    const rankCls=i<3?'r'+(i+1):'';
    const meRow=p.id===socket.id?'me-row':'';
    const subLabel=isFirst?'Champion!':isBad?'...pray harder.':'';
    return `<div class="score-row ${meRow}" style="border:1px solid rgba(255,255,255,.05);${isFirst?'padding:14px 16px;':''}">
      <div class="score-bar" style="width:${Math.max(0,Math.round((pts/maxPts)*100))}%;background:${isBad?'rgba(232,80,50,.1)':'rgba(232,200,74,.06)'}"></div>
      <div class="score-rank ${rankCls}" style="font-size:${isFirst?'1.4rem':'1.05rem'}">${isBad?'ğŸ˜­':(i<3?icons[i]:i+1)}</div>
      <div class="score-av" style="font-size:${isFirst?'1.7rem':'1.3rem'}">${p.avatar}</div>
      <div class="score-name" style="font-size:${isFirst?'.85rem':'.75rem'}">${p.name}${subLabel?`<br><span style="font-size:.7rem;font-style:italic;color:${isBad?'rgba(232,80,50,.5)':'rgba(255,255,255,.3)'};font-family:Crimson Pro,serif">${subLabel}</span>`:''}</div>
      <div class="score-pts" style="font-size:${isFirst?'1.4rem':'1.05rem'};color:${isBad?'#e85050':'#e8c84a'}">${pts}<span style="font-size:.5rem;opacity:.4;font-family:Cinzel,serif"> PTS</span></div>
    </div>`;
  }).join('');
  const mb=document.getElementById('final-message');
  if(showWinner){
    const r=WINNER_ROASTS[S.diff]||WINNER_ROASTS.easy;
    mb.textContent=r[Math.floor(Math.random()*r.length)];
    mb.style.cssText='display:block;margin:14px 0;padding:14px 16px;background:rgba(232,200,74,.07);border:1px solid rgba(232,200,74,.2);border-radius:2px;font-family:Crimson Pro,serif;font-size:1.05rem;color:#e8dfc0;line-height:1.5;text-align:center;font-style:italic';
  } else if(showLoser){
    const r=LOSER_SHAME[S.diff]||LOSER_SHAME.easy;
    mb.textContent=r[Math.floor(Math.random()*r.length)];
    mb.style.cssText='display:block;margin:14px 0;padding:14px 16px;background:rgba(232,80,50,.08);border:1px solid rgba(232,80,50,.3);border-radius:2px;font-family:Crimson Pro,serif;font-size:1.05rem;color:#e8a090;line-height:1.5;text-align:center;font-style:italic';
  } else { mb.style.display='none'; }
  const fq=document.getElementById('final-quote');
  if(showLoser){ fq.innerHTML='"Get thee behind me, Satan!" â€” Jesus to Peter, Matthew 16:23<br><span style="font-size:.78rem;opacity:.6">(We felt this was appropriate)</span>'; fq.style.color='rgba(232,80,50,.45)'; }
  else { fq.innerHTML='"Well done, good and faithful servant" â€” Matthew 25:23'; fq.style.color=''; }
  if(S.isHost) document.getElementById('play-again-btn').style.display='block';
  show('final');
  if(showWinner) launchConfetti();
  else if(showLoser) launchHellfire();
}

function goSetup(){ show('setup'); }

// â”€â”€ CONFETTI â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function launchConfetti(){
  const wrap=document.getElementById('cf-wrap');
  wrap.innerHTML='<div class="cf" id="cf-inner"></div>';
  const inner=document.getElementById('cf-inner');
  const colors=['#e8c84a','#e85050','#50c878','#5080e8','#e850c8','#c8e850'];
  for(let i=0;i<50;i++){
    const p=document.createElement('div'); p.className='cf-p';
    const c=colors[Math.floor(Math.random()*colors.length)];
    const sz=6+Math.random()*8;
    p.style.cssText=`left:${Math.random()*100}%;background:${c};width:${sz}px;height:${sz}px;animation-delay:${Math.random()*2}s;animation-duration:${2.5+Math.random()*2}s`;
    inner.appendChild(p);
  }
  setTimeout(()=>{ if(wrap) wrap.innerHTML=''; },6000);
}

// â”€â”€ HELLFIRE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function launchHellfire(){
  const wrap=document.getElementById('cf-wrap');
  wrap.innerHTML='<div class="cf" id="cf-inner"></div><div id="hell-overlay"></div>';
  const inner=document.getElementById('cf-inner');
  if(!document.getElementById('hell-style')){
    const s=document.createElement('style'); s.id='hell-style';
    s.textContent=`#hell-overlay{position:fixed;inset:0;pointer-events:none;z-index:998;background:radial-gradient(ellipse at bottom,rgba(200,40,10,.35) 0%,transparent 70%);animation:hellPulse 1.5s ease-in-out infinite alternate;}@keyframes hellPulse{from{opacity:.4}to{opacity:1}}.fire-p{position:absolute;bottom:-30px;animation:fireRise linear forwards;pointer-events:none;}@keyframes fireRise{0%{transform:translateY(0) scale(1) rotate(-5deg);opacity:1;}50%{transform:translateY(-45vh) scale(1.3) rotate(5deg);opacity:.8;}100%{transform:translateY(-110vh) scale(.6) rotate(-10deg);opacity:0;}}`;
    document.head.appendChild(s);
  }
  const flames=['ğŸ”¥','ğŸ”¥','ğŸ”¥','ğŸ’€','ğŸ˜ˆ','ğŸ”¥','ğŸ”¥','ğŸ‘¹','ğŸ”¥','ğŸ˜­'];
  for(let i=0;i<35;i++){
    const p=document.createElement('div'); p.className='fire-p';
    p.textContent=flames[Math.floor(Math.random()*flames.length)];
    p.style.cssText=`left:${Math.random()*100}%;font-size:${1+Math.random()*1.2}rem;animation-delay:${Math.random()*3}s;animation-duration:${2+Math.random()*2.5}s`;
    inner.appendChild(p);
  }
  setTimeout(()=>{ if(wrap) wrap.innerHTML=''; const hs=document.getElementById('hell-style'); if(hs) hs.remove(); },8000);
}

// â”€â”€ TOAST â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function toast(msg){
  const el=document.getElementById('toast');
  el.textContent=msg; el.style.opacity='1';
  if(toastTimeout) clearTimeout(toastTimeout);
  toastTimeout=setTimeout(()=>{ el.style.opacity='0'; },2800);
}

// â”€â”€ CHAT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
let chatOpen = true;
let unreadCount = 0;
let chatVisible = false;

function showChat() {
  document.getElementById('chat-wrap').classList.remove('hidden');
  chatVisible = true;
}
function hideChat() {
  document.getElementById('chat-wrap').classList.add('hidden');
  chatVisible = false;
}
function toggleChat() {
  const body = document.getElementById('chat-body');
  chatOpen = !chatOpen;
  body.classList.toggle('collapsed', !chatOpen);
  if (chatOpen) {
    unreadCount = 0;
    const badge = document.getElementById('chat-badge');
    badge.style.display = 'none';
    badge.textContent = '0';
  }
}
function sendChat() {
  const input = document.getElementById('chat-input');
  const text = input.value.trim();
  if (!text || !S.roomCode) return;
  socket.emit('chat_message', { text });
  input.value = '';
}
function appendChatMsg({ name, avatar, text, system }) {
  const msgs = document.getElementById('chat-msgs');
  const div = document.createElement('div');
  div.className = 'chat-msg' + (system ? ' system' : '');
  if (system) {
    div.innerHTML = `<div class="chat-msg-body"><div class="chat-msg-text">${text}</div></div>`;
  } else {
    div.innerHTML = `<div class="chat-msg-av">${avatar}</div><div class="chat-msg-body"><div class="chat-msg-name">${name}</div><div class="chat-msg-text">${text}</div></div>`;
  }
  msgs.appendChild(div);
  msgs.scrollTop = msgs.scrollHeight;
  // Unread badge if collapsed
  if (!chatOpen) {
    unreadCount++;
    const badge = document.getElementById('chat-badge');
    badge.style.display = 'inline';
    badge.textContent = unreadCount;
  }
}

socket.on('chat_message', ({ name, avatar, text }) => {
  appendChatMsg({ name, avatar, text });
});

// Show chat when in lobby/game â€” integrated into original show()

// â”€â”€ MUSIC â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// Free royalty-free Byzantine chant from Internet Archive / Wikimedia Commons
const TRACKS = [
  '/chant.mp3',
  'https://ia800305.us.archive.org/32/items/AgniParthene_201410/AgniParthene.mp3',
];
let audio = null;
let musicPlaying = false;
let trackIndex = 0;

function toggleMusic() {
  if (!audio) {
    audio = new Audio();
    audio.volume = 0.18;
    audio.loop = false;
    audio.onended = () => {
      trackIndex = (trackIndex + 1) % TRACKS.length;
      audio.src = TRACKS[trackIndex];
      audio.play().catch(() => {});
    };
    audio.onerror = () => {
      // fallback: try next track
      trackIndex = (trackIndex + 1) % TRACKS.length;
      if (trackIndex < TRACKS.length) {
        audio.src = TRACKS[trackIndex];
        audio.play().catch(() => {});
      }
    };
  }
  if (musicPlaying) {
    audio.pause();
    musicPlaying = false;
    document.getElementById('music-btn').textContent = 'ğŸµ';
    document.getElementById('music-btn').classList.remove('playing');
  } else {
    audio.src = TRACKS[trackIndex];
    audio.play().then(() => {
      musicPlaying = true;
      document.getElementById('music-btn').textContent = 'ğŸ”‡';
      document.getElementById('music-btn').classList.add('playing');
    }).catch(() => {
      toast('Allow audio in your browser to play music');
    });
  }
}

init();
</script>

<!-- CHAT -->
<div id="chat-wrap" class="hidden">
  <div id="chat-header" onclick="toggleChat()">
    <span id="chat-title">âœ¦ Room Chat</span>
    <span id="chat-badge">0</span>
  </div>
  <div id="chat-body">
    <div id="chat-msgs"></div>
    <div id="chat-input-row">
      <input id="chat-input" type="text" placeholder="Say something holy..." maxlength="200" onkeydown="if(event.key==='Enter')sendChat()">
      <button id="chat-send" onclick="sendChat()">Send</button>
    </div>
  </div>
</div>

<!-- MUSIC BUTTON -->
<button id="music-btn" onclick="toggleMusic()" title="Toggle Orthodox music">ğŸµ</button>

</body>
</html>
